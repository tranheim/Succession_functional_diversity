---
title: "ad_tests"
author: "Tord Ranheim"
date: "2025-04-22"
output:
  html_document:
    keep_md: no
---


This script analyses differences in microbial diversity (taxonomic, functional) across the land-use gradient


##################################################################################################################################
```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = "png",
                      dpi=300,
                      echo=F,
                      cache=T, echo=T)
```


```{r Clear directory}

rm(list=ls())

```


                                       LOAD LIBRARIES
#############################################################################################
```{r libraries to load}
library(tidyverse)
library(rstatix)
library(lme4)
library(jtools)
library(DHARMa)
library(ggplot2)
library(glmm.hp)

```



                                       LOAD DATA
#############################################################################################
```{r Load data}

#Load metadata
metadata = read.table("/Users/tranheim/Desktop/Studier/Remiil-NFI/Study 1/Processing/Metadata/Result/metadata.txt")
row.names(metadata) = metadata$Sample

#Load diversity estimates
res = read.table("/Users/tranheim/Desktop/Studier/Remiil-NFI/Study 1/Analyses/Revision/diversity/results/diversity_results.txt")

```


```{r Merge data}

metadata = left_join(metadata, res)

rm(res)
```


We are interested in comparing grasslands to their reference endpoint (i.e. Forests), but also to compare different grassland successional stages against each other. For this we create a new metadata set where the forest level is set as reference level for linear models.
```{r Set forest as reference level}

metadata_ref = metadata
metadata_ref$Succession <- as.factor(metadata_ref$Succession) #Set successional stage as factor
metadata_ref$Succession <- relevel(metadata_ref$Succession, ref="Forest") #Set forest as reference level

```


                                      TEST WITH FOREST AS REFERENCE
###################################################################################################

```{r Fungal taxonomic diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(shannon_fungi ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(shannon_fungi ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```

```{r Fungal ccycling diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(cazyme_div_fungi ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(cazyme_div_fungi ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```
```{r Fungal pcycling diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(pcyc_div_fungi ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(pcyc_div_fungi ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```



```{r Bacteria taxonomic diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(shannon_bacteria ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(shannon_bacteria ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```

```{r Bacteria ccyc diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(cazyme_div_bacteria ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(cazyme_div_bacteria ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```



```{r Bacteria pcyc diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(pcyc_div_bacteria ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(pcyc_div_bacteria ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```


```{r Bacteria ncyc diversity}

#Any difference between grasslands?
metadata %>% 
  filter(Succession != "Forest") %>%
  kruskal_test(ncyc_div_bacteria ~ Succession) #No significant differences between grassland sites


#Test between grassland and forest sites
mod1 <- lmer(ncyc_div_bacteria ~ Succession + (1|Par) + (1|Distance),
             data = metadata_ref)
summ(mod1, exp = T)


#Check model disagnostics
par(mar = rep(2, 4))
mod1 %>% 
 simulateResiduals(plot = T) #Looks ok

```




                                              DERIVING EFFECT SIZES
###################################################################################################################################
```{r Derive paired observations}

#Managed
k1 = metadata %>% dplyr::group_split(Succession)
f1 = k1[[1]] %>% filter(Par %in% k1[[3]]$Par)
g1 = k1[[3]] %>% filter(Par %in% f1$Par)
s1 = rbind(f1,g1)

#Recent
f1 = k1[[1]] %>% filter(Par %in% k1[[4]]$Par)
g1 = k1[[4]] %>% filter(Par %in% f1$Par)
s2 = rbind(f1,g1)

#Late
f1 = k1[[1]] %>% filter(Par %in% k1[[2]]$Par)
g1 = k1[[2]] %>% filter(Par %in% f1$Par)
s3 = rbind(f1,g1)

rm(f1,g1)
```


    TAXONOMIC DIVERSITY
###################################################################
```{r es fungi managed}

#Managed
mod = lmer(shannon_fungi ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "Taxonomic"
r1 = d1


#Managed with covariates
mod = lmer(shannon_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "Taxonomic"
r2 = d1

```


```{r es fungi recent}

#Managed
mod = lmer(shannon_fungi ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "Taxonomic"
r3 = d1


#Managed with covariates
mod = lmer(shannon_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "Taxonomic"
r4 = d1

```


```{r es fungi late}

#Managed
mod = lmer(shannon_fungi ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "Taxonomic"
r5 = d1


#Managed with covariates
mod = lmer(shannon_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "Taxonomic"
r6 = d1

```


```{r es bacteria managed}

#Managed
mod = lmer(shannon_bacteria ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "Taxonomic"
r7 = d1


#Managed with covariates
mod = lmer(shannon_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s1)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "Taxonomic"
r8 = d1

```


```{r es bacteria recent}

mod = lmer(shannon_bacteria ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "Taxonomic"
r9 = d1

#With covariates
mod = lmer(shannon_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "Taxonomic"
r10 = d1

```


```{r es bacteria late}

mod = lmer(shannon_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "Taxonomic"
r11 = d1


#With covariates
mod = lmer(shannon_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "Taxonomic"
r12 = d1

```



    C-CYCLING DIVERSITY
###################################################################
```{r es fungi managed ccycling}

#Managed
mod = lmer(cazyme_div_fungi ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "C-cycling"
r13 = d1


#Managed with covariates
mod = lmer(cazyme_div_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "C-cycling"
r14 = d1

```


```{r es fungi recent}

#Managed
mod = lmer(cazyme_div_fungi ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "C-cycling"
r15 = d1


#Managed with covariates
mod = lmer(cazyme_div_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "C-cycling"
r16 = d1

```


```{r es fungi late}

#Managed
mod = lmer(cazyme_div_fungi ~ Succession + (1|Par) + (1|Distance), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "C-cycling"
r17 = d1


#Managed with covariates
mod = lmer(cazyme_div_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "C-cycling"
r18 = d1

```


```{r es bacteria managed}

#Managed
mod = lmer(cazyme_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "C-cycling"
r19 = d1


#Managed with covariates
mod = lmer(cazyme_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N), REML = T, 
           data = s1)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "C-cycling"
r20 = d1

```


```{r es bacteria recent}

mod = lmer(cazyme_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "C-cycling"
r21 = d1

#With covariates
mod = lmer(cazyme_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + (1|Distance) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "C-cycling"
r22 = d1

```


```{r es bacteria late}

mod = lmer(cazyme_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "C-cycling"
r23 = d1


#With covariates
mod = lmer(cazyme_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "C-cycling"
r24 = d1

```


    P-CYCLING DIVERSITY
###################################################################
```{r es fungi managed pcycling}

#Managed
mod = lmer(pcyc_div_fungi ~ Succession + (1|Par), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "P-cycling"
r25 = d1


#Managed with covariates
mod = lmer(pcyc_div_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "P-cycling"
r26 = d1

```


```{r es fungi recent}

#Managed
mod = lmer(pcyc_div_fungi ~ Succession + (1|Par), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "P-cycling"
r27 = d1


#Managed with covariates
mod = lmer(pcyc_div_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "P-cycling"
r28 = d1

```


```{r es fungi late}

#Managed
mod = lmer(pcyc_div_fungi ~ Succession + (1|Par), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "P-cycling"
r29 = d1


#Managed with covariates
mod = lmer(pcyc_div_fungi ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Fungi"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "P-cycling"
r30 = d1

```


```{r es bacteria managed}

#Managed
mod = lmer(pcyc_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "P-cycling"
r31 = d1


#Managed with covariates
mod = lmer(pcyc_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N), REML = T, 
           data = s1)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "P-cycling"
r32 = d1

```


```{r es bacteria recent}

mod = lmer(pcyc_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "P-cycling"
r33 = d1

#With covariates
mod = lmer(pcyc_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "P-cycling"
r34 = d1

```


```{r es bacteria late}

mod = lmer(pcyc_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "P-cycling"
r35 = d1


#With covariates
mod = lmer(pcyc_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material)+ 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "P-cycling"
r36 = d1

```


    N-CYCLING DIVERSITY
###################################################################

```{r es bacteria managed}

#Managed
mod = lmer(ncyc_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s1)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 0
d1$Diversity = "N-cycling"
r37 = d1


#Managed with covariates
mod = lmer(ncyc_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N), REML = T, 
           data = s1)
summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Managed vs Forest"
d1$Covariates = 1
d1$Diversity = "N-cycling"
r38 = d1

```


```{r es bacteria recent}

mod = lmer(ncyc_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s2)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 0
d1$Diversity = "N-cycling"
r39 = d1

#With covariates
mod = lmer(ncyc_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material) + 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s2)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Recent vs Forest"
d1$Covariates = 1
d1$Diversity = "N-cycling"
r40 = d1

```


```{r es bacteria late}

mod = lmer(ncyc_div_bacteria ~ Succession + (1|Par), REML = T, 
           data = s3)
summ(mod)
aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 0
d1$Diversity = "N-cycling"
r41 = d1


#With covariates
mod = lmer(ncyc_div_bacteria ~ Succession + (1|Par) + 
              (1|Parent_material)+ 
             (1|pH) + (1|C.N) + (1|LDMC), REML = T, 
           data = s3)

summ(mod)

aov = Anova(mod, type = 2, test = "F")
d1 = effectsize::omega_squared(aov, alternative = "two.sided")
d1$Community = "Bacteria"
d1$Comparison = "Late vs Forest"
d1$Covariates = 1
d1$Diversity = "N-cycling"
r42 = d1

```


```{r merge and write}

rm(s1,s2,s3)
dfs <- Filter(function(x) is(x, "data.frame"), mget(ls()))
dfs = dfs[5:46]
res = do.call("rbind", dfs)

write.table(res, file = "./results/es_ad.txt")


```




                                          HIERARCHICAL PARTITIONING
###################################################################################################################################
  
```{r fungal diversity}

#Taxonomic
mod = lmer(shannon_fungi ~ Succession + pH + C.N + LDMC + Tot_C + Parent_material + (1|Par) + (1|Distance), REML = T, 
           data = metadata)

mod.h = glmm.hp(mod)
mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Fungi"
k1$Diversity = "Taxonomic"
r1 = k1


#C-cycling
mod = lmer(cazyme_div_fungi ~ Succession + pH + C.N + LDMC + Parent_material + BD + (1|Par) + (1|Distance), REML = T, 
           data = metadata)

mod.h = glmm.hp(mod)
mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Fungi"
k1$Diversity = "C-cycling"
r2 = k1


#P-cycling
mod = lmer(pcyc_div_fungi ~ Succession + pH + C.N + LDMC + Parent_material + Tot_N + (1|Par) + (1|Distance), REML = T, 
           data = metadata)

mod.h = glmm.hp(mod)
mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Fungi"
k1$Diversity = "P-cycling"
r3 = k1

```
  

```{r bacterial diversity}

#Taxonomic
mod = lmer(shannon_bacteria ~ Succession + pH + C.N + LDMC + 
             Tot_C + BD + 
             (1|Par) + (1|Distance), REML = T, 
           data = metadata)

mod.h = glmm.hp(mod)

mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Bacteria"
k1$Diversity = "Taxonomic"
r4 = k1


#C-cycling
mod = lmer(cazyme_div_bacteria ~ Succession + pH + C.N + LDMC + Parent_material + BD + (1|Par) + (1|Distance), REML = T, 
           data = metadata)

mod.h = glmm.hp(mod)
mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Bacteria"
k1$Diversity = "C-cycling"
r5 = k1


#P-cycling
mod = lmer(pcyc_div_fungi ~ Succession + pH + C.N + LDMC + 
             Parent_material + Tot_C + MAT + N_min +
             (1|Par) + (1|Distance), REML = T, 
           data = metadata)

mod.h = glmm.hp(mod)
mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Bacteria"
k1$Diversity = "P-cycling"
r6 = k1


#N-cycling
mod = lmer(ncyc_div_bacteria ~ Succession + pH + C.N + LDMC + Parent_material + (1|Par) + (1|Distance), REML = T, 
           data = metadata)
mod.h = glmm.hp(mod)
mod.h
k1 = as.data.frame(mod.h$hierarchical.partitioning)
k1$Factor = row.names(k1)
k1$Community = "Bacteria"
k1$Diversity = "N-cycling"
r7 = k1

```

```{r}

res = rbind(r1,r2,r3,r4,r5,r6,r7)

write.table(res, file = "./results/hierarchical.txt")
```





                                      TEST FOR DIFFERENCE BETWEEN FOREST TYPES
##################################################################################################################################

```{r Taxonomic diversity}

#Fungi
metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(shannon_fungi ~ Age*Evenness)

#Bacteria
metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(shannon_bacteria ~ Age*Evenness)

```

```{r Functional diversity}

#Fungi
metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(cazyme_div_fungi ~ Age*Evenness)

metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(pcyc_div_fungi ~ Age*Evenness)

#Bacteria
metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(cazyme_div_bacteria ~ Age*Evenness)

metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(pcyc_div_bacteria ~ Age*Evenness)

metadata %>% 
  filter(Succession == "Forest") %>%
  anova_test(ncyc_div_bacteria ~ Age*Evenness)

```






